<!-- ========================================
     MANEJADOR DE VALIDACIÓN NATIVA DEL NAVEGADOR
     PAQUETEX v4.0
     ======================================== -->

<div id="native-validation-container" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 9999; max-width: 400px; background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-left: 4px solid #ef4444; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
    <!-- Iconos de Advertencia -->
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 1rem;">
        <div style="width: 1.5rem; height: 1.5rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 0.5rem; background-color: rgba(239, 68, 68, 0.1);">
            <svg class="w-4 h-4 text-red-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
        </div>
        <div style="width: 3rem; height: 3rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: rgba(245, 158, 11, 0.1);">
            <svg class="w-8 h-8 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
        </div>
    </div>
    
    <!-- Contenido del Error -->
    <div style="text-align: center; margin-bottom: 1.5rem;">
        <h3 id="validation-title" style="font-size: 1.125rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem;">Error de Validación</h3>
        <p id="validation-message" style="font-size: 0.875rem; color: #374151; line-height: 1.6;">Por favor, complete todos los campos requeridos.</p>
        <div id="validation-field" style="margin-top: 0.5rem; padding: 0.5rem; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.25rem;">
            <span style="font-size: 0.75rem; color: #92400e; font-weight: 500;">Campo: </span>
            <span id="field-name" style="font-size: 0.75rem; color: #92400e;">Nombre del cliente</span>
        </div>
    </div>
    
    <!-- Botón de Cerrar -->
    <div style="display: flex; justify-content: center;">
        <button 
            type="button" 
            id="validation-close-btn"
            style="color: white; font-weight: 500; padding: 0.5rem 1.5rem; border-radius: 0.5rem; transition: all 0.2s; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3); border: none; cursor: pointer;"
            onmouseover="this.style.background='linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(59, 130, 246, 0.4)'"
            onmouseout="this.style.background='linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(59, 130, 246, 0.3)'"
        >
            Cerrar
        </button>
    </div>
</div>

<script>
// Manejador de Validación Nativa del Navegador
(function() {
    'use strict';
    
    console.log('Inicializando manejador de validación nativa...');
    
    // Referencias a los elementos del DOM
    const container = document.getElementById('native-validation-container');
    const title = document.getElementById('validation-title');
    const message = document.getElementById('validation-message');
    const fieldName = document.getElementById('field-name');
    const closeBtn = document.getElementById('validation-close-btn');
    
    // Función para mostrar error de validación
    function mostrarErrorValidacion(campo, mensaje, tipoValidacion) {
        console.log('Mostrando error de validación:', { campo, mensaje, tipoValidacion });
        
        // Obtener el nombre del campo
        const nombreCampo = obtenerNombreCampo(campo);
        
        // Actualizar contenido
        title.textContent = 'Error de Validación';
        message.textContent = mensaje;
        fieldName.textContent = nombreCampo;
        
        // Mostrar el contenedor con animación
        container.style.display = 'block';
        container.style.opacity = '0';
        container.style.transform = 'scale(0.95)';
        
        // Animar la aparición
        setTimeout(() => {
            container.style.transition = 'all 0.3s ease-out';
            container.style.opacity = '1';
            container.style.transform = 'scale(1)';
        }, 10);
        
        // Auto-cerrar después de 8 segundos
        setTimeout(() => {
            cerrarError();
        }, 8000);
    }
    
    // Función para obtener el nombre del campo
    function obtenerNombreCampo(campo) {
        // Buscar label asociado
        const label = document.querySelector(`label[for="${campo.id}"]`);
        if (label) {
            return label.textContent.replace('*', '').trim();
        }
        
        // Buscar placeholder
        if (campo.placeholder) {
            return campo.placeholder;
        }
        
        // Usar el nombre del campo
        return campo.name || campo.id || 'Campo';
    }
    
    // Función para cerrar error
    function cerrarError() {
        container.style.transition = 'all 0.2s ease-in';
        container.style.opacity = '0';
        container.style.transform = 'scale(0.95)';
        
        setTimeout(() => {
            container.style.display = 'none';
        }, 200);
    }
    
    // Función para obtener mensaje de validación personalizado
    function obtenerMensajeValidacion(campo) {
        const validacion = campo.validity;
        
        if (validacion.valueMissing) {
            return 'Este campo es obligatorio. Por favor, complételo.';
        }
        
        if (validacion.tooShort) {
            const minLength = campo.getAttribute('minlength') || campo.minLength;
            return `El campo debe tener al menos ${minLength} caracteres.`;
        }
        
        if (validacion.tooLong) {
            const maxLength = campo.getAttribute('maxlength') || campo.maxLength;
            return `El campo no puede tener más de ${maxLength} caracteres.`;
        }
        
        if (validacion.typeMismatch) {
            if (campo.type === 'email') {
                return 'Por favor, ingrese un email válido.';
            }
            if (campo.type === 'url') {
                return 'Por favor, ingrese una URL válida.';
            }
            return 'El formato del campo no es válido.';
        }
        
        if (validacion.patternMismatch) {
            return 'El formato del campo no coincide con el patrón requerido.';
        }
        
        if (validacion.rangeUnderflow) {
            const min = campo.getAttribute('min') || campo.min;
            return `El valor debe ser mayor o igual a ${min}.`;
        }
        
        if (validacion.rangeOverflow) {
            const max = campo.getAttribute('max') || campo.max;
            return `El valor debe ser menor o igual a ${max}.`;
        }
        
        if (validacion.stepMismatch) {
            return 'El valor no es válido para este campo.';
        }
        
        if (validacion.badInput) {
            return 'El valor ingresado no es válido.';
        }
        
        if (validacion.customError) {
            return campo.validationMessage || 'Error de validación personalizado.';
        }
        
        return 'Por favor, complete este campo correctamente.';
    }
    
    // Función para configurar captura de validación
    function configurarCapturaValidacion() {
        console.log('Configurando captura de validación nativa...');
        
        // Interceptar el evento de validación nativa
        document.addEventListener('invalid', function(event) {
            event.preventDefault(); // Prevenir la alerta nativa
            
            const campo = event.target;
            const mensaje = obtenerMensajeValidacion(campo);
            
            // Mostrar nuestro error personalizado
            mostrarErrorValidacion(campo, mensaje, 'validacion');
            
            // Enfocar el campo
            campo.focus();
        }, true);
        
        // Interceptar el evento de envío de formulario
        document.addEventListener('submit', function(event) {
            const formulario = event.target;
            
            // Verificar si el formulario es válido
            if (!formulario.checkValidity()) {
                event.preventDefault(); // Prevenir el envío
                
                // Encontrar el primer campo inválido
                const campoInvalido = formulario.querySelector(':invalid');
                if (campoInvalido) {
                    const mensaje = obtenerMensajeValidacion(campoInvalido);
                    mostrarErrorValidacion(campoInvalido, mensaje, 'validacion');
                    campoInvalido.focus();
                }
            }
        });
        
        // Interceptar el evento de cambio en campos
        document.addEventListener('input', function(event) {
            const campo = event.target;
            
            // Si el campo tiene validación y está siendo validado
            if (campo.willValidate && campo.validity.valid) {
                // Ocultar error si el campo ahora es válido
                cerrarError();
            }
        });
    }
    
    // Event listener para el botón de cerrar
    closeBtn.addEventListener('click', cerrarError);
    
    // Función global para mostrar errores de validación personalizados
    window.mostrarErrorValidacionNativa = function(campo, mensaje) {
        mostrarErrorValidacion(campo, mensaje, 'personalizado');
    };
    
    // Función global para validar un formulario específico
    window.validarFormularioNativo = function(formularioId) {
        const formulario = document.getElementById(formularioId);
        if (formulario) {
            if (!formulario.checkValidity()) {
                const campoInvalido = formulario.querySelector(':invalid');
                if (campoInvalido) {
                    const mensaje = obtenerMensajeValidacion(campoInvalido);
                    mostrarErrorValidacion(campoInvalido, mensaje, 'validacion');
                    campoInvalido.focus();
                }
                return false;
            }
            return true;
        }
        return false;
    };
    
    // Inicializar cuando el DOM esté listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', configurarCapturaValidacion);
    } else {
        configurarCapturaValidacion();
    }
    
    console.log('Manejador de validación nativa inicializado correctamente');
})();
</script>
